"use strict";(self.webpackChunkserial_terminal=self.webpackChunkserial_terminal||[]).push([[179],{607:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},i=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,a=0,i=t.length;a<i;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0});var o=n(320),s=n(617);n(502);var l,c,u,d,f,w,v,b,h,m,p=n(391);"serviceWorker"in navigator&&window.addEventListener("load",(function(){return r(void 0,void 0,void 0,(function(){var e,t;return a(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,navigator.serviceWorker.register("service-worker.js",{scope:"."})];case 1:return e=n.sent(),console.log("SW registered: ",e),[3,3];case 2:return t=n.sent(),console.log("SW registration failed: ",t),[3,3];case 3:return[2]}}))}))}));var g,y,E,I,k,R,C,O,A=!1,B=1,L=K("2E"),T=K("3F"),N=K("07"),x=(K("20"),K("6300000A")),S=K("6301000A"),_=K("6100000A"),P=K("6100010A"),U=new Uint8Array([0,163,16,69,69,0,0,0,2,1]),F=new Uint8Array([0,163,16,69,69,0,0,0,2,1]),W=new URLSearchParams(window.location.search).has("polyfill"),D=new o.Terminal({scrollback:1e4}),G=new s.FitAddon;D.loadAddon(G);var j=new TextEncoder,H="";function M(e){for(var t=0;t<l.options.length;++t){var n=l.options[t];if("prompt"!==n.value){var r=n;if(r.port===e)return r}}return null}function X(e){var t=document.createElement("option");return t.textContent="Port ".concat(B++),t.port=e,l.appendChild(t),t}function q(){if(!D)throw new Error("no terminal instance found");if(0!==D.rows){D.selectAll();var e=D.getSelection();D.clearSelection();var t=URL.createObjectURL(new Blob([(new TextEncoder).encode(e).buffer],{type:"text/plain"})),n=document.createElement("a");n.download="terminal_content_".concat((new Date).getTime(),".txt"),n.href=t,n.click()}else console.log("No output yet")}function V(){return r(this,void 0,void 0,(function(){var e,t;return a(this,(function(n){switch(n.label){case 0:if("prompt"!=l.value)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,(W?p.serial:navigator.serial).requestPort({})];case 2:return y=n.sent(),[3,4];case 3:return n.sent(),[2];case 4:return e=function(e){return M(e)||X(e)}(y),e.selected=!0,[3,6];case 5:t=l.selectedOptions[0],y=t.port,n.label=6;case 6:return[2]}}))}))}function z(){return"custom"==u.value?Number.parseInt(d.value):Number.parseInt(u.value)}function J(){D.writeln("<DISCONNECTED>"),l.disabled=!1,c.textContent="Connect",c.disabled=!1,u.disabled=!1,d.disabled=!1,f.disabled=!1,w.disabled=!1,v.disabled=!1,b.disabled=!1,y=void 0}function K(e){if(0==e.length)throw new Error("hex string cannot be empty");if(e.length%2!=0)throw new Error("Must have an even number of hex digits");for(var t=e.length/2,n=new Uint8Array(t),r=0;r<t;r++)n[r]=parseInt(e.substr(2*r,2),16);return n}D.onData((function(e){if(h.checked&&D.write(e),null!=(null==y?void 0:y.writable)){var t=y.writable.getWriter();m.checked?(H+=e,"\r"===e&&(t.write(j.encode(H)),t.releaseLock(),H="")):t.write(j.encode(e)),t.releaseLock()}else console.warn("unable to find writable port")})),document.addEventListener("DOMContentLoaded",(function(){return r(void 0,void 0,void 0,(function(){var e,t,n;return a(this,(function(o){switch(o.label){case 0:return(e=document.getElementById("terminal"))&&(D.open(e),G.fit()),document.getElementById("download").addEventListener("click",q),l=document.getElementById("ports"),(c=document.getElementById("connect")).addEventListener("click",(function(){y?function(){r(this,void 0,void 0,(function(){var e,t;return a(this,(function(n){switch(n.label){case 0:return e=y,y=void 0,E?[4,E.cancel()]:[3,2];case 1:n.sent(),n.label=2;case 2:if(!e)return[3,6];n.label=3;case 3:return n.trys.push([3,5,,6]),[4,e.close()];case 4:return n.sent(),[3,6];case 5:return t=n.sent(),console.error(t),D.writeln("<ERROR: ".concat(t.message,">")),[3,6];case 6:return J(),[2]}}))}))}():function(){r(this,void 0,void 0,(function(){var e,t,n,r,o,s;return a(this,(function(h){switch(h.label){case 0:return[4,V()];case 1:if(h.sent(),!y)return[2];e={baudRate:z(),dataBits:Number.parseInt(f.value),parity:w.value,stopBits:Number.parseInt(v.value),flowControl:b.checked?"hardware":"none",baudrate:z(),databits:Number.parseInt(f.value),stopbits:Number.parseInt(v.value),rtscts:b.checked},console.log(e),l.disabled=!0,c.textContent="Connecting...",c.disabled=!0,u.disabled=!0,d.disabled=!0,f.disabled=!0,w.disabled=!0,v.disabled=!0,b.disabled=!0,h.label=2;case 2:return h.trys.push([2,7,,8]),[4,y.open(e)];case 3:return h.sent(),D.writeln("<CONNECTED>"),null==(null==y?void 0:y.writable)?(console.warn("unable to find writable port"),[2]):(t=y.writable.getWriter(),n=200,[4,setTimeout((function(){t.write(L)}),n+=200)]);case 4:return h.sent(),[4,setTimeout((function(){t.write(T)}),n+=200)];case 5:return h.sent(),[4,setTimeout((function(){if(3==I&&3==O){for(var e=0;e<_.length;e++)t.write(_.subarray(e,e+1));for(e=0;e<U.length;e++)t.write(U.subarray(e,e+1))}}),n+=200)];case 6:return h.sent(),setTimeout((function(){if(3==I&&3==O){for(var e=0;e<P.length;e++)t.write(P.subarray(e,e+1));for(e=0;e<F.length;e++)t.write(F.subarray(e,e+1))}}),n+=200),setTimeout((function(){3==I&&3==O&&(g=1,t.write(x))}),n+=200),setTimeout((function(){3==I&&3==O&&(g=2,t.write(S),D.writeln("start streaming after 5 seconds"))}),n+=200),setTimeout((function(){A=!0,t.write(N)}),n+=5e3),setTimeout((function(){t.releaseLock()}),n+=200),c.textContent="Disconnect",c.disabled=!1,[3,8];case 7:return r=h.sent(),console.error(r),D.writeln("<ERROR: ".concat(r.message,">")),J(),[2];case 8:o=function(){var e,t,n,r;return a(this,(function(o){switch(o.label){case 0:o.trys.push([0,5,,6]),E=y.readable.getReader(),t=["u24","u8","i24r","i24r","u8","i24r","i24r"],n=function(){var n,r,o;return a(this,(function(a){switch(a.label){case 0:return[4,E.read()];case 1:return n=a.sent(),r=n.value,o=n.done,r?[4,new Promise((function(n){if(console.log(r),n(),255==r[0]&&A&&(D.writeln("Ack Received"),A&&D.writeln("Start Streaming")),255==r[0]||0==r[0])e=new Uint8Array(i([],r,!0));else{var a=new Uint8Array(e.length+r.length);a.set(e),a.set(r,e.length),e=a}if(0==e[0]&&18==e.length&&A){var o=function(e,t){for(var n=[],r=0,a=0;a<t.length;a++)"u8"===t[a]?n.push(e[r++]):"u24"===t[a]?n.push((255&e[r++])+((255&e[r++])<<8)+((255&e[r++])<<16)):"i24r"===t[a]&&n.push(((255&e[r++])<<16)+((255&e[r++])<<8)+(255&e[r++]));return n}(e.subarray(1),t);D.writeln(String(o))}if(47==e[1]&&8==e.length)for(var s=2;s<8;s++)I=(255&e[s++])+((255&e[s++])<<8),k=(255&e[s++])+((255&e[s++])<<8),R=e[s++],C=e[s++],D.writeln("FW VERSION RESPONSE Received"),D.writeln("Firmware identifier: "+I),D.writeln("Firmware major: "+k),D.writeln("Firmware minor: "+R),D.writeln("Firmware internal: "+C);else if(37==e[1]&&3==e.length)O=e[2],D.writeln("Hardware version: "+O);else if(98==e[1]&&13==e.length){for(1==g?D.writeln("EXG CHIP 1 CONFIGURATION"):D.writeln("EXG CHIP 2 CONFIGURATION"),s=3;s<e.length;s++)D.write(String(e[s])+" ");D.writeln("")}}))]:[3,3];case 2:a.sent(),a.label=3;case 3:return o?[2,"break"]:[2]}}))},o.label=1;case 1:return[5,n()];case 2:if("break"===o.sent())return[3,4];o.label=3;case 3:return[3,1];case 4:return E.releaseLock(),E=void 0,[3,6];case 5:return r=o.sent(),console.error(r),D.writeln("<ERROR: ".concat(r.message,">")),[3,6];case 6:return[2]}}))},h.label=9;case 9:return y&&y.readable?[5,o()]:[3,11];case 10:return h.sent(),[3,9];case 11:if(!y)return[3,16];h.label=12;case 12:return h.trys.push([12,14,,15]),[4,y.close()];case 13:return h.sent(),[3,15];case 14:return s=h.sent(),console.error(s),D.writeln("<ERROR: ".concat(s.message,">")),[3,15];case 15:J(),h.label=16;case 16:return[2]}}))}))}()})),document.getElementById("write").addEventListener("click",(function(){var e=K(document.getElementById("bytesToWrite").value);if(null!=e)if(null!=(null==y?void 0:y.writable)){var t=y.writable.getWriter();t.write(e),t.releaseLock()}else console.warn("unable to find writable port");else console.warn("input not valid")})),(u=document.getElementById("baudrate")).addEventListener("input",(function(){"custom"==u.value?d.hidden=!1:d.hidden=!0})),d=document.getElementById("custom_baudrate"),f=document.getElementById("databits"),w=document.getElementById("parity"),v=document.getElementById("stopbits"),b=document.getElementById("rtscts"),h=document.getElementById("echo"),m=document.getElementById("enter_flush"),t=document.getElementById("convert_eol"),n=function(){D.setOption("convertEol",t.checked)},t.addEventListener("change",n),n(),[4,(W?p.serial:navigator.serial).getPorts()];case 1:return o.sent().forEach((function(e){return X(e)})),W||(navigator.serial.addEventListener("connect",(function(e){X(e.target)})),navigator.serial.addEventListener("disconnect",(function(e){var t=M(e.target);t&&t.remove()}))),[2]}}))}))}))}},e=>{e.O(0,[216],(()=>(607,e(e.s=607)))),e.O()}]);